<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="width=640, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge" >

    <title>新建活动</title>
    <link rel="stylesheet" href="/static/collage/css/index1.css">
    <link rel="stylesheet" href="/static/collage/css/lCalendar.css">
    <!--<script src="js/jquery-2.1.0.js"></script>-->
    <script src="/static/collage/js/jquery.js"></script>
    <script src="/static/collage/js/index1.js"></script>
    <script src="/static/collage/js/lCalendar.js"></script>
    <script src="/static/collage/js/small-exif.js"></script>
</head>
<body>

    <div class="ning_box" id="ning_box">
        <div class="ning_banner">
            <p class="nb_p1">
                <span>音乐</span>
            </p>
            <span class="nb_span2">个人<br>中心</span>
            <p class="nb_p2">
                活动时间
                <input id="input1" type="text" readonly="" name="input_date" value="2018-06-28 00：00" data-lcalendar="2010-01-11,2020-12-31" />
                到
                <input id="input2" type="text" readonly="" name="input_date" value="2018-06-28 00：00" data-lcalendar="2010-01-11,2020-12-31" />
            </p>
            <textarea class="nb_p3">请输入活动标题</textarea>
        </div>

        <div class="ning_spms">
            <p>商品描述</p>
            <textarea class="spms_font">请输入商品描述</textarea>
            <!--<div class="img_hezi">-->
                <!--<img src="img/img1.jpg" alt="">-->
                <!--<span></span>-->
            <!--</div>-->
            <div class="spms_img">
                <div class="img_btn">
                    <img src="/static/collage/img/jiahao.png" alt="">
                    <p>（请上传 5 张商品图片，不上传则不显示）</p>
                    <input type="file" id="updateImg1" />
                </div>
            </div>
            <div class="ning_tuan">
                <p>原价：<input type="text" value="1000" /><i>元</i></p>
                <p>参团与拼团需预付：<input type="text" value="10" /><i>元</i></p>
                <ul class="tuan_ul">
                    <li><p><input type="text" value="3" />人团</p><p>拼团价：<input type="text" value="388" />元/人 <span class="shanchu_btn"></span></p></li>
                    <li><p><input type="text" value="5" />人团</p><p>拼团价：<input type="text" value="288" />元/人 <span class="shanchu_btn"></span></p></li>
                    <li><p><input type="text" value="8" />人团</p><p>拼团价：<input type="text" value="188" />元/人 <span class="shanchu_btn"></span></p></li>
                    <span class="tianjia_btn">添加</span>
                    <p>
                        你可以设置多组团，最多设置<i>3</i>组，拼团人数应该逐渐增多，拼团价应逐渐减小，请认真设置，有人参团后不可修改。建议3人拼团价=原价×30%，5人拼团价=原价×20%，8人拼团价=原价×10%。
                    </p>
                </ul>
            </div>
        </div>



        <div class="ning_lqxx">
            <span>领取信息</span>
            <div class="lqxx_box">
                <p>兑奖时间：<input type="text" value="2017-08-11—2017-09-11" /></p>
                <p>机构地址：<input type="text" value="幸福大街222号" /></p>
                <p>领奖电话：<input type="text" value="89187167" /></p>
            </div>

            <div class="TJBox">
                <!--
                    <div class="xx_div">
                        <textarea>添加领取信息</textarea>
                        <span></span>
                    </div>
                    <div class="img_div">
                        <img src="img/jiahao.png" alt="">
                        <p>（点击添加图片，不上传则不显示）</p>
                        <span></span>
                        <input type="file" id="updateImg3" />
                    </div>
                    <div class="sp_div">
                        <textarea>请输入视频地址</textarea>
                        <span></span>
                    </div>
                -->
            </div>

            <ul>
                <li class="tj_wenben">
                    <img src="/static/collage/img/TJwenben.png" alt="">
                    <p>添加文本</p>
                </li>
                <li class="tj_tupian">
                    <img src="/static/collage/img/TJtupian.png" alt="">
                    <p>添加图片</p>
                </li>
                <li class="tj_shipin">
                    <img src="/static/collage/img/TJshipin.png" alt="">
                    <p>添加视频</p>
                </li>
            </ul>

        </div>


        <div class="ning_jgjs">
            <p>机构介绍</p>
            <textarea class="jgjs_font">此处填写机构介绍，不填写则不显示</textarea>
            <div class="jgjs_img">
                <div class="jgjs_btn">
                    <img src="/static/collage/img/jiahao.png" alt="">
                    <p>（请上传 10 张商品图片，不上传则不显示）</p>
                    <input type="file" id="updateImg2" />
                </div>
            </div>
        </div>

        <div class="ning_telephone">
            <p>咨询电话</p>
            <ul class="telephone_ul">
                <li><img src="/static/collage/img/loufang.png" alt=""> <input type="text" placeholder="请输入门店名称"/></li>
                <li><img src="/static/collage/img/dizhi.png" alt=""> <input type="text" placeholder="请输入地址"/></li>
                <!--<li><img src="img/dizhi.png" alt=""> <p>点击定位地址</p></li>-->
                <li><img src="/static/collage/img/weizhi.png" alt=""> <input type="text" placeholder="请输入楼号门牌"/></li>
                <li><img src="/static/collage/img/dianhua1.png" alt=""> <input type="text" placeholder="请输入联系电话"/></li>
            </ul>

        </div>


        <div class="ning_footer">
            <div>
                <span id="activi_btn">预览活动</span>
                <span id="activi_save">保存活动</span>
            </div>
        </div>
    </div>
    <div id="activi_box"></div>
    <script type="text/javascript">
    	$(function(){
    		//排除活动图片、拼团人数价格
    		$("#activi_save").click(function(){
    			var keys = new Array("start_time", "end_time", "title", "explain", "price", "advance");
    			keys[12] = "cashing_time";
    			keys[13] = "address";
    			keys[14] = "mobile";
    			keys[15] = "introductions";
    			keys[16] = "store_name";
    			keys[17] = "store_address";
    			keys[18] = "building";
    			keys[19] = "contact";
    			var inputs = $("#ning_box").find(":input").not(".img_hezi,#updateImg1,#updateImg2");
    			var formdata = new FormData();
    			//console.log(keys);return;
    			//筛选出拼团人数/价格、领取信息的文本图片视频等信息，这两个单独获取
    			inputs.each(function(i, r){
    				if ($(r).parent().parent().parent().is("ul[class=tuan_ul]")) {
    					return true;
    				}
    				if ($(r).parent(".xx_div").length || $(r).parent(".img_div").length) {
    					return true;
    				}
    				var content = $(r).val() == null ? $(r).text() : $(r).val();
    				//console.log(i, r);
	                formdata.append(keys[i], content);
	            });
	            //return;
	            //获取活动描述图片
	            var enc_group1 = new Array();
	            if ($(".ning_spms").children(".img_hezi").children("img").length != 0) {
	            	$(".ning_spms").children(".img_hezi").children("img").each(function(i, r){
		            	enc_group1[i] =  r.src;
		            });
	            }
	            //console.log(enc_group1);return;
	            formdata.append("enc_group1", enc_group1);
	            //单独获取拼团人数、价格
	            var tuan_ul = $(".tuan_ul").find(":input");
	            var arr = new Array();
	            tuan_ul.each(function(i, r){
	            	if (i % 2 == 0) {
						arr[i] = $(tuan_ul[i]).val() + ":" + $(tuan_ul[i+1]).val();
	            	}
	            });
	            //console.log(arr);return;
	            formdata.append("collage", arr);
	            //获取领取信息的图片、文本、视频
	            var j = 1;
	            var enc_group2 = new Array();
	            if ($(".xx_div").children(":input").length != 0) {
	            	$(".xx_div").children(":input").each(function(i, r){
	            		enc_group2[j] = $(r).val();
	            		j++;
	            	});
	            }
	            if ($(".TJBox").children(".img_hezi").find("img").length != 0) {
	            	$(".TJBox").children(".img_hezi").find("img").each(function(i, r){
	            		enc_group2[j] = r.src;
	            		j++;
	            	});
	            }
	            formdata.append("enc_group2", enc_group2);
	            //获取机构图片
	            var enc_group3 = new Array();
	            if ($(".ning_jgjs").children(".img_hezi").find("img").length != 0) {
	            	$(".ning_jgjs").children(".img_hezi").find("img").each(function(i, r){
	            		enc_group3[i] = r.src;
	            	});
	            }
	            formdata.append("enc_group3", enc_group3);
	            $.ajax({//以下几项配置，只要是设计post，必填
	                headers: {
	                  'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
	                },
	                type: "POST",
	                url: "/collage/create",
	                data: formdata, 
	                async: false,
	                cache: false,
	                contentType: false,
	                processData: false,
	                success: function(msg){
	                    if (msg == true) { alert("成功"); }
	                }
	            });
    		});
    	});
    </script>
</body>
</html>