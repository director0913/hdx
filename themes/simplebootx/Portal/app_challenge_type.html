<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>题目分类</title>
<tc_include file="Public:head1" />
<link type="text/css" rel="stylesheet" href="__TMPL__Public/css/activity/mypublic.css" />
<link type="text/css" rel="stylesheet" href="__TMPL__Public/css/activity/signup.css" />
<link type="text/css" rel="stylesheet" href="__TMPL__Public/css/font-awesome.min.css" />
<style type="text/css">
    .pagelist{padding:10px 12px;clear:both;text-align:center; font-size:0;
    font-family:Arial, "\5B8B\4F53", sans-serif;vertical-align:top} 
    .pagelist a, .pagelist span{display:inline-block;height:36px;line-height:36px; width:38px;
    margin:5px 0 0 0;background:#fff;border:1px solid #e5e5e5;overflow:hidden;vertical-align:top; color:#646464;font-size:14px;} 
    .pagelist a:hover{background:#F1F1F1;border:1px solid #DBDBDB;text-decoration:none} 
    .pagelist a, .pagelist a:visited{color:#252525} 
    .pagelist a:hover, .pagelist a:active{color:#8D827E} 
    .pagelist .current{background:#F1F1F1;border:1px solid #DBDBDB;color:#8D827E} 
    .pagelist a.current, .pagelist a.current:visited{color:#8D827E} 
    .pagelist a.current:hover, .pagelist a.current:active{color:#8D827E} 
    .prev,.next{font-family:"\5B8B\4F53", sans-serif;font-weight:bold;font-size:16px} 
    .prev{color:#e5e5e5} 
    .ep-pages-all{font-size:12px;vertical-align:top}
	#baoming table input{ width:100%;}
	.addtype{ width:100px; height:30px; line-height:30px; text-align:center; border:1px dashed #069; cursor:pointer; margin-bottom:20px; margin-left:40px;}
	.pd20{ padding:5px 20px !important;}
	.t_a_l{ text-align:left !important;}
	strong{ font-weight:300;}
</style>
</head>
<body>
<tc_include file="Public:nav" />
<div class="toptu">
	<div class="pagediv1">
        <div class="f_l">
            <if condition="empty($users_info['avatar'])">
                <img src="__TMPL__Public/images/touxiang.jpg" class="touxiang f_l" />
            <else />
                <img src="{:sp_get_asset_upload_path($users_info['avatar'])}" class="touxiang f_l" />
            </if>
            <php>$curr_user = sp_get_current_user(); </php>
            <php>$lastmonth = strtotime("-1 month",$curr_user['valid_time']);$now = time();</php>
            <div class="f_l" >
                <p class="name">{$users_info.user_nicename}</p>
                <p class="leixing">账号类型：<eq name="users_info['level']" value="0">普通会员<span style="color:#FA741B;margin-left:10px;">(您的账号
                <php>$endtime =strtotime($curr_user['create_time'])+3600*24*30; </php>
                <php>echo date("Y-m-d",$endtime);</php>后将无法使用！)</span><a href="{:U('portal/index/show_shengji',array('menu'=>3))}">升级会员</a></eq>
                <eq name="users_info['level']" value="1">亲情会员
                <if condition="$lastmonth elt $now">
                    <span style="color:#FA741B;margin-left:10px;">(您的账号
                    <php>echo date("Y-m-d",$user['valid_time']);</php>后将无法使用！)</span>
                </if>
                <a href="{:U('portal/index/show_vip',array('menu'=>2))}">如何升级权限</a></eq>
                <eq name="users_info['level']" value="2">金牌会员
                <if condition="$lastmonth elt $now">
                    <span style="color:#FA741B;margin-left:10px;">(您的账号
                    <php>echo date("Y-m-d",$user['valid_time']);</php>后将无法使用！)</span>
                </if>
                <a href="{:U('portal/index/show_vip',array('menu'=>2))}">如何升级权限</a></eq></p>
                <p class="bianji"><a href="{:U('user/center/index')}"><span class="fa fa-pencil"></span>编辑资料</a></p>
            </div>
        </div>
        <div class="f_r">
        	<div class="f_l fenxinxi">
                <a href="{:U('portal/activity/index')}">
            	<p class="number">{$activity_num}</p>
                <p class="typename">我的活动</p>
                </a>
            </div>
            <p class="fenge f_l"></p>
        	<div class="f_l fenxinxi active">
                <a href="{:U('portal/app/index')}">
            	<p class="number">{$app_num}</p>
                <p class="typename">我的应用</p>
                </a>
            </div>
        </div>
        <p class="c_b"></p>
    </div>
</div>
<div class="zhongzhaidiv">
	<p class="daohang"><a href="{:U('portal/app/index')}">我的应用</a><span>></span>{$activity['title']}</p>
    <ul class="tab p_r">
		<li data-tab="baoming" class="active">题目类型</li>
        <p class="c_b"></p>
    </ul>
    <div class="xiadiv" id="baoming">
    	<table border="0" cellpadding="0" cellspacing="0" class="formtb wt100">
        	<tr>
            	<th width="40"></th>
            	<th width="100">序号</th>
                <th align="left" class="pd20">类型名称</th>
                <th width="250">操作</th>
            </tr>
            <foreach name="list" item="vo" >
            <tr>
                <td></td>
                <td><strong class="listorder">{$vo.listorder}</strong><input type="text" value="{$vo.listorder}" name="listorder" class="d_n"/></td>
                <td class="pd20 t_a_l"><strong class="name">{$vo.name}</strong><input type="text" value="{$vo.name}" name="name" class="d_n"/></td>
                <td class="t_a_l">
                    <span><a href="javascript:void(0)" class="edit" data-id="{$vo.id}" >编辑</a>&nbsp;|&nbsp;</span>
                    <span><a href="javascript:void(0)" class="delete" data-id="{$vo.id}" >删除</a>&nbsp;|&nbsp;</span>
                    <span><a href="{:U('portal/app/app_challenge_answer',array('aid'=>$aid,'tid'=>$vo['id']))}">题目管理</a></span>
                </td>
            </tr>
            </foreach>
        </table>
        <p class="addtype">添加分类</p>
    </div>
</div>
<tc_include file="Public:footer"/>
<div class="fufuwudiv p_r">
    <div class="fuwutab"><span class="fa fa-user"></span>用户服务</div>
    <div class="fufuwuqu">
        <p class="p1"><span class="fa fa-volume-control-phone"></span>客服电话</p>
        <p class="p2">13001265153</p>
        <p class="p3">客服微信</p>
        <img src="__TMPL__Public/images/kefuweixin.jpg" />
    </div>
</div>
<div class="fuxinxi" style="display:none;">
    <div class="titlediv">
        <p class="dingtitle">完善以下信息，方便我们为您推荐更合适的活动</p>
        <p class="zaishuo"><a href="javascript:void(0);" onclick="$('.fuxinxi').hide();">下次再说吧~</a></p>
    </div>
    <table border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td class="lefttd">机构名称</td>
            <td><input type="text" placeholder="请输入机构名称" name="school" value="{$users_info['school']}"/></td>
        </tr>
        <tr>
            <td class="lefttd">校长/负责人</td>
            <td><input type="text" placeholder="请输入校长/负责人姓名" name="contact" value="{$users_info['contact']}"/></td>
        </tr>
        <tr>
            <td class="lefttd">校长/负责人电话</td>
            <td><input type="text" placeholder="请输入校长/负责人电话" name="mobile" value="{$users_info['mobile']}"/></td>
        </tr>
        <tr>
            <td class="lefttd">机构项目</td>
            <td>
                <label><input type="checkbox" value="1" />幼少儿培训</label>
                <label><input type="checkbox" value="1" />初高中培训</label>
                <label><input type="checkbox" value="1" />幼儿园</label>
                <label><input type="checkbox" value="1" />早教机构</label><br/>
                <label><input type="checkbox" value="1" />文化课培训</label>
                <label><input type="checkbox" value="1" />素质教育课程</label>
                <label><input type="checkbox" value="1" />其他</label>
            </td>
        </tr>
        <tr>
            <td class="lefttd">地区</td>
            <td class="address">
                <select>
                    <option>请选择省份</option>
                </select>
                <select style="margin-right:0;">
                    <option>请选择城市</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="lefttd">规模</td>
            <td>
                <label><input type="radio" value="1" />300人以下</label>
                <label><input type="radio" value="1" />300-800人</label>
                <label><input type="radio" value="1" />800-3000人</label>
                <label><input type="radio" value="1" />3000人以上</label>
            </td>
        </tr>
        <tr>
            <td class="lefttd"></td>
            <td align="center">
                <input type="submit" class="tijiao" value="确认提交" />
            </td>
        </tr>
    </table>
</div>
</body>
<script type="text/javascript">
$(function(){
	$(".dropdown").click(function(e){
		e.stopPropagation();
		$(this).find(".dropitem").toggleClass("d_n");
	});
	$("body").click(function(){
		$(".dropdown").find(".dropitem").addClass("d_n");
	});
	$(".tab li").click(function(){
		if($(this).attr("data-url")!="")
		{
			window.location.href=$(this).attr("data-url");return;
		}
		$(".tab li.active").removeClass("active");
		//隐藏所有标记
		$(".xiadiv").hide();
		//获取标记
		var idzhi=$(this).attr("data-tab");
		//显示标记对应的div
		$("#"+idzhi).show();
		$(this).addClass("active");
	});
	//点击编辑按钮。
	$("#baoming").on("click",".edit",function(){
		//获取自己身上的id值。
		var id=$(this).attr("data-id");
		//插入确定和取消按钮。
		var btnstr='<span><a href="javascript:void(0)" class="btnok" data-id="'+id+'">确定</a>&nbsp;|&nbsp;</span>'+
                   '<span><a href="javascript:void(0)" class="cancel" data-id="'+id+'">取消</a>&nbsp;|&nbsp;</span>';
		//添加到当前结点父节点的前面。
		$(this).parent().parent().prepend(btnstr);
		//隐藏父节点的父节点中的span标签。
		$(this).parent().parent().parent().find("strong").hide();
		//显示父节点的父节点中的input标签。
		$(this).parent().parent().parent().find("input").show();
		//删除自己标签。
		$(this).parent().remove();
	});
	//点击取消按钮。
	$("#baoming").on("click",".cancel",function(){
		//获取自己身上的id值。
		var id=$(this).attr("data-id");
		//添加编辑按钮。
		var btnstr='<span><a href="javascript:void(0)" class="edit" data-id="'+id+'" >编辑</a>&nbsp;|&nbsp;</span>';
		//添加到当前结点父节点的前面。
		$(this).parent().parent().prepend(btnstr);
		//隐藏父节点的父节点中的span标签。
		$(this).parent().parent().parent().find("strong").show();
		//显示父节点的父节点中的input标签。
		$(this).parent().parent().parent().find("input").hide();
		//删除确定和取消按钮。
		$(this).parent().parent().find(".cancel,.btnok").parent().remove();
	});
	//点击确定按钮。
	$("#baoming").on("click",".btnok",function(){
		//执行异步将id、序号、名字传递过去。
		var data={id:$(this).attr("data-id"),
				  listorder:$(this).parent().parent().parent().find("input[name='listorder']").val(),
				  name:$(this).parent().parent().parent().find("input[name='name']").val()};
		if(data.name=="")
		{
			alert("类型名称不能为空！"); return;
		}
		var caozuobtn=$(this);
		$.post("{:U('portal/app/challenge_type_post',array('aid'=>$aid))}",data,
		function(res){
			if(res.status>0)
			{
				//为strong标签中的内容赋值。
				caozuobtn.parent().parent().parent().find(".listorder").html(data.listorder);
				caozuobtn.parent().parent().parent().find(".name").html(data.name);
				//隐藏input标签。
				caozuobtn.parent().parent().parent().find("input").hide();
				//显示strong标签。
				caozuobtn.parent().parent().parent().find("strong").show();
				//获取当前结点的父节点的父节点。
				var caozuoitem=caozuobtn.parent().parent();
				var caozuostr='<span><a href="javascript:void(0)" class="edit" data-id="'+res.id+'" >编辑</a>&nbsp;|&nbsp;</span>'+
							  '<span><a href="javascript:void(0)" class="delete" data-id="'+res.id+'" >删除</a>&nbsp;|&nbsp;</span>'+
							  '<span><a href="'+res.url+'">题目管理</a></span>';
				//自己节点中的操作全部改变。
				$(caozuoitem).html(caozuostr);
			}
			else
			{
				alert(res.msg);
			}
		});
		//如果执行成功
	});
	//点击删除按钮。
	$("#baoming").on("click",".delete",function(){
		if(!window.confirm('删除将不可恢复，确认吗？')) return;
		var id=$(this).attr('data-id');
		var that=$(this);
		if(id>0)
		{
			 $.post("{:U('portal/app/challenge_type_delete')}",
			{
			   id:id
			},
			function(data,status){
				if(data.status<0)
				{
					alert(data.msg);
				}
				if(data.status==1)
				{
					//删除当前列。
					that.parent().parent().parent().remove();
				}
			});
		}
		else
		{
			//删除当前列。
			that.parent().parent().parent().remove();
		}
	})
	$(".addtype").click(function(){
		var itemstr='<tr>'+
						'<td></td>'+
						'<td><strong class="listorder d_n">0</strong><input type="text" value="0" name="listorder"/></td>'+
						'<td class="pd20 t_a_l"><strong class="name d_n"></strong><input type="text" name="name"/></td>'+
						'<td class="t_a_l">'+
							'<span><a href="javascript:void(0)" class="btnok" data-id="0" >确定</a>&nbsp;|&nbsp;</span>'+
							'<span><a href="javascript:void(0)" class="delete" data-id="0" >删除</a></span>'+
						'</td>'+
					'</tr>';
		$("#baoming tbody").append(itemstr);
	});
})
$("#search1").click(function(){
    var name=$("#searchname1").val();
    var id="{$_GET['userid']}";
    var url="/index.php/portal/app/app_show_prize/userid/"+id+"/aid/{$aid}/keyword/"+name+".shtml";
    window.location.href = url;
})
$(".tijiao").click(function(){
    var school=$("input[name='school']").val();
    var contact=$("input[name='contact']").val();
    var mobile=$("input[name='mobile']").val();
    //alert(school+contact+mobile);
    $.post("{:U('user/profile/full_post')}",
        {
           school:school,
           contact:contact,
           mobile:mobile
        },
        function(data,status){
            if(data.status>0)
            {
                //$('.fuxinxi').hide();
                window.location.reload();
            }
            else
            {
                alert(data.msg);
            }
        });
})
</script>
</html>
